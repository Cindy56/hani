<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.game.trade.modules.finance.dao.FinanceRechargeDao">
    
	<sql id="financeRechargeColumns">
		a.id AS "id",
		a.user_id AS "user.id",
		a.user_name AS "userName",
		a.company_id AS "companyId",	
		a.office_id AS "officeId",
		a.recharge_no AS "rechargeNo",
		a.payment_channel_id AS "paymentChannelId",
		a.bank_code AS "bankCode",
		a.bank_name AS "bankName",
		a.bank_card_no AS "bankCardNo",
		a.recharge_amount AS "rechargeAmount",
		a.validate_code AS "validateCode",
		a.recharge_date AS "rechargeDate",
		a.third_pay_no AS "thirdPayNo",
		a.third_pay_date AS "thirdPayDate",
		a.audit_user_id AS "auditUserId",
		a.audit_user_name AS "auditUserName",
		a.audit_date AS "auditDate",
		a.status AS "status",
		a.create_date AS "createDate",
		a.create_by AS "createBy.id",
		a.update_date AS "updateDate",
		a.update_by AS "updateBy.id",
		a.del_flag AS "delFlag"
	</sql>
	
	<sql id="financeRechargeJoins">
	</sql>
    
	<select id="get" resultType="FinanceRecharge">
		SELECT 
			<include refid="financeRechargeColumns"/>
		FROM finance_recharge a
		<include refid="financeRechargeJoins"/>
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="FinanceRecharge">
		SELECT 
			<include refid="financeRechargeColumns"/>
		FROM finance_recharge a
		<include refid="financeRechargeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="user != null and user.id != null and user.id != ''">
				AND a.user_id = #{user.id}
			</if>
			<if test="userName != null and userName != ''">
				AND a.user_name LIKE 
					<if test="dbName == 'oracle'">'%'||#{userName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{userName}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{userName},'%')</if>
			</if>
			<if test="companyId != null and companyId != ''">
				AND a.company_id = #{companyId} 
			</if>
			<if test="officeId != null and officeId != ''">
				AND a.office_id LIKE 
					<if test="dbName == 'oracle'">'%'||#{officeId}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{officeId}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{officeId},'%')</if>
			</if>
			<if test="rechargeNo != null and rechargeNo != ''">
				AND a.recharge_no LIKE 
					<if test="dbName == 'oracle'">'%'||#{rechargeNo}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{rechargeNo}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{rechargeNo},'%')</if>
			</if>
			<if test="paymentChannelId != null and paymentChannelId != ''">
				AND a.payment_channel_id = #{paymentChannelId}
			</if>
			<if test="beginRechargeDate != null and endRechargeDate != null and beginRechargeDate != '' and endRechargeDate != ''">
				AND a.recharge_date BETWEEN #{beginRechargeDate} AND #{endRechargeDate}
			</if>
			<if test="thirdPayNo != null and thirdPayNo != ''">
				AND a.third_pay_no = #{thirdPayNo}
			</if>
			<if test="thirdPayDate != null and thirdPayDate != ''">
				AND a.third_pay_date = #{thirdPayDate}
			</if>
			<if test="auditUserName != null and auditUserName != ''">
				AND a.audit_user_name = #{auditUserName}
			</if>
			<if test="beginAuditDate != null and endAuditDate != null and beginAuditDate != '' and endAuditDate != ''">
				AND a.audit_date BETWEEN #{beginAuditDate} AND #{endAuditDate}
			</if>
			<if test="status != null and status != ''">
				AND a.status = #{status}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="FinanceRecharge">
		SELECT 
			<include refid="financeRechargeColumns"/>
		FROM finance_recharge a
		<include refid="financeRechargeJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO finance_recharge(
			id,
			user_id,
			user_name,
			company_id,
			office_id,
			recharge_no,
			payment_channel_id,
			bank_code,
			bank_name,
			bank_card_no,
			recharge_amount,
			validate_code,
			recharge_date,
			third_pay_no,
			third_pay_date,
			audit_user_id,
			audit_user_name,
			audit_date,
			status,
			create_date,
			create_by,
			update_date,
			update_by,
			del_flag
		) VALUES (
			#{id},
			#{user.id},
			#{userName},
			#{companyId},
			#{officeId},
			#{rechargeNo},
			#{paymentChannelId},
			#{bankCode},
			#{bankName},
			#{bankCardNo},
			#{rechargeAmount},
			#{validateCode},
			#{rechargeDate},
			#{thirdPayNo},
			#{thirdPayDate},
			#{auditUserId},
			#{auditUserName},
			#{auditDate},
			#{status},
			#{createDate},
			#{createBy.id},
			#{updateDate},
			#{updateBy.id},
			#{delFlag}
		)
	</insert>
	
	<update id="update">
		UPDATE finance_recharge SET 	
			user_id = #{user.id},
			user_name = #{userName},
			company_id = #{companyId},
			office_id = #{officeId},
			recharge_no = #{rechargeNo},
			payment_channel_id = #{paymentChannelId},
			bank_code = #{bankCode},
			bank_name = #{bankName},
			bank_card_no = #{bankCardNo},
			recharge_amount = #{rechargeAmount},
			validate_code = #{validateCode},
			recharge_date = #{rechargeDate},
			third_pay_no = #{thirdPayNo},
			third_pay_date = #{thirdPayDate},
			audit_user_id = #{auditUserId},
			audit_user_name = #{auditUserName},
			audit_date = #{auditDate},
			status = #{status},
			del_flag = #{delFlag}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE finance_recharge SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	
</mapper>